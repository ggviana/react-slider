!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["react","prop-types"],t):e.bundle=t(e.React,e.PropTypes)}(this,function(t,n){"use strict";function i(e){return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1}function s(e){for(var t in e)document.addEventListener(t,e[t],!1)}function o(e){return null==e?[]:Array.isArray(e)?e:[e]}function r(e){return null!=e&&1===e.length?e[0]:e}t=t&&t.hasOwnProperty("default")?t.default:t,n=n&&n.hasOwnProperty("default")?n.default:n;var a="horizontal",u="vertical",l={min:0,max:100,step:1,minDistance:0,defaultValue:0,orientation:a,className:"slider",handleClassName:"handle",handleActiveClassName:"active",barClassName:"bar",withBars:!1,pearling:!1,disabled:!1,snapDragDisabled:!1,invert:!1},h={min:n.number,max:n.number,step:n.number,minDistance:n.number,defaultValue:n.oneOfType([n.number,n.arrayOf(n.number)]),value:n.oneOfType([n.number,n.arrayOf(n.number)]),orientation:n.oneOf(["horizontal","vertical"]),className:n.string,handleClassName:n.string,handleActiveClassName:n.string,withBars:n.bool,barClassName:n.string,pearling:n.bool,disabled:n.bool,snapDragDisabled:n.bool,invert:n.bool,onBeforeChange:n.func,onChange:n.func,onAfterChange:n.func,onSliderClick:n.func},p={getChildContext:!0,render:!0,componentWillMount:!0,componentDidMount:!0,componentWillReceiveProps:!0,shouldComponentUpdate:!0,componentWillUpdate:!0,componentDidUpdate:!0,componentWillUnmount:!0},c=function(e){return!0===p[e]},v=function(e){return"function"==typeof e},f=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},m=function(n){function l(e){f(this,l);var t=_(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,e)),n=t._or(o(e.value),o(e.defaultValue));t.pendingResizeTimeouts=[];for(var i=[],s=0;s<n.length;s++)n[s]=t._trimAlignValue(n[s],e),i.push(s);return t.state={index:-1,upperBound:0,sliderLength:0,value:n,zIndices:i},function(e,t){null==t&&(t=Object.getPrototypeOf(e)),Object.getOwnPropertyNames(t).filter(function(e){var n=t[e];return v(n)&&!c(e)}).forEach(function(n){return e[n]=t[n].bind(e)})}(t),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(l,t.Component),d(l,[{key:"componentWillReceiveProps",value:function(e){for(var t=this._or(o(e.value),this.state.value),n=0;n<t.length;n++)this.state.value[n]=this._trimAlignValue(t[n],e);this.state.value.length>t.length&&(this.state.value.length=t.length),0===this.state.upperBound&&this._handleResize()}},{key:"_or",value:function(e,n){var i=t.Children.count(this.props.children);switch(i){case 0:return e.length>0?e:n;case e.length:return e;case n.length:return n;default:return e.length===i&&n.length===i||console.warn(this.constructor.displayName+": Number of values does not match number of children."),function(e,t,n){for(var i=(t-e)/(n-1),s=[],o=0;o<n;o++)s.push(e+i*o);return s}(this.props.min,this.props.max,i)}}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this._handleResize),this._handleResize()}},{key:"componentWillUnmount",value:function(){this._clearPendingResizeTimeouts(),window.removeEventListener("resize",this._handleResize)}},{key:"getValue",value:function(){return r(this.state.value)}},{key:"_handleResize",value:function(){var e=window.setTimeout(function(){this.pendingResizeTimeouts.shift();var e=this.refs.slider,t=this.refs.handle0,n=e.getBoundingClientRect(),i=this._sizeKey(),s=n[this._posMaxKey()],o=n[this._posMinKey()];this.setState({upperBound:e[i]-t[i],sliderLength:Math.abs(s-o),handleSize:t[i],sliderStart:this.props.invert?s:o})}.bind(this),0);this.pendingResizeTimeouts.push(e)}},{key:"_clearPendingResizeTimeouts",value:function(){do{var e=this.pendingResizeTimeouts.shift();clearTimeout(e)}while(this.pendingResizeTimeouts.length)}},{key:"_calcOffset",value:function(e){var t=this.props.max-this.props.min;if(0===t)return 0;return(e-this.props.min)/t*this.state.upperBound}},{key:"_calcValue",value:function(e){return e/this.state.upperBound*(this.props.max-this.props.min)+this.props.min}},{key:"_buildHandleStyle",value:function(e,t){var n={position:"absolute",willChange:this.state.index>=0?this._posMinKey():"",zIndex:this.state.zIndices.indexOf(t)+1};return n[this._posMinKey()]=e+"px",n}},{key:"_buildBarStyle",value:function(e,t){var n={position:"absolute",willChange:this.state.index>=0?this._posMinKey()+","+this._posMaxKey():""};return n[this._posMinKey()]=e,n[this._posMaxKey()]=t,n}},{key:"_getClosestIndex",value:function(e){for(var t=Number.MAX_VALUE,n=-1,i=this.state.value,s=i.length,o=0;o<s;o++){var r=this._calcOffset(i[o]),a=Math.abs(e-r);a<t&&(t=a,n=o)}return n}},{key:"_calcOffsetFromPosition",value:function(e){var t=e-this.state.sliderStart;return this.props.invert&&(t=this.state.sliderLength-t),t-=this.state.handleSize/2}},{key:"_forceValueFromPosition",value:function(e,t){var n=this._calcOffsetFromPosition(e),i=this._getClosestIndex(n),s=this._trimAlignValue(this._calcValue(n)),o=this.state.value.slice();o[i]=s;for(var r=0;r<o.length-1;r+=1)if(o[r+1]-o[r]<this.props.minDistance)return;this.setState({value:o},t.bind(this,i))}},{key:"_getMousePosition",value:function(e){return[e["page"+this._axisKey()],e["page"+this._orthogonalAxisKey()]]}},{key:"_getTouchPosition",value:function(e){var t=e.touches[0];return[t["page"+this._axisKey()],t["page"+this._orthogonalAxisKey()]]}},{key:"_getKeyDownEventMap",value:function(){return{keydown:this._onKeyDown,focusout:this._onBlur}}},{key:"_getMouseEventMap",value:function(){return{mousemove:this._onMouseMove,mouseup:this._onMouseUp}}},{key:"_getTouchEventMap",value:function(){return{touchmove:this._onTouchMove,touchend:this._onTouchEnd}}},{key:"_createOnKeyDown",value:function(e){var t=this;return function(n){t.props.disabled||(t._start(e),s(t._getKeyDownEventMap()),i(n))}}},{key:"_createOnMouseDown",value:function(e){var t=this;return function(n){if(!t.props.disabled){var o=t._getMousePosition(n);t._start(e,o[0]),s(t._getMouseEventMap()),i(n)}}}},{key:"_createOnTouchStart",value:function(t){var n=this;return function(i){if(!(n.props.disabled||e.touches.length>1)){var o=n._getTouchPosition(i);n.startPosition=o,n.isScrolling=void 0,n._start(t,o[0]),s(n._getTouchEventMap()),function(e){e.stopPropagation&&e.stopPropagation()}(i)}}}},{key:"_start",value:function(e,t){var n=document.activeElement,i=this.refs["handle"+e];n&&n!=document.body&&n!=i&&n.blur&&n.blur(),this.hasMoved=!1,this._fireChangeEvent("onBeforeChange");var s=this.state.zIndices;s.splice(s.indexOf(e),1),s.push(e),this.setState({startValue:this.state.value[e],startPosition:t,index:e,zIndices:s})}},{key:"_onMouseUp",value:function(){this._onEnd(this._getMouseEventMap())}},{key:"_onTouchEnd",value:function(){this._onEnd(this._getTouchEventMap())}},{key:"_onBlur",value:function(){this._onEnd(this._getKeyDownEventMap())}},{key:"_onEnd",value:function(e){!function(e){for(var t in e)document.removeEventListener(t,e[t],!1)}(e),this.setState({index:-1},this._fireChangeEvent.bind(this,"onAfterChange"))}},{key:"_onMouseMove",value:function(e){var t=this._getMousePosition(e),n=this._getDiffPosition(t[0]),i=this._getValueFromPosition(n);this._move(i)}},{key:"_onTouchMove",value:function(e){if(!(e.touches.length>1)){var t=this._getTouchPosition(e);if(void 0===this.isScrolling){var n=t[0]-this.startPosition[0],s=t[1]-this.startPosition[1];this.isScrolling=Math.abs(s)>Math.abs(n)}if(this.isScrolling)this.setState({index:-1});else{i(e);var o=this._getDiffPosition(t[0]),r=this._getValueFromPosition(o);this._move(r)}}}},{key:"_onKeyDown",value:function(e){if(!(e.ctrlKey||e.shiftKey||e.altKey))switch(e.key){case"ArrowLeft":case"ArrowUp":return this._moveDownOneStep();case"ArrowRight":case"ArrowDown":return this._moveUpOneStep();case"Home":return this._move(this.props.min);case"End":return this._move(this.props.max);default:return}}},{key:"_moveUpOneStep",value:function(){var e=this.state.value[this.state.index]+this.props.step;this._move(Math.min(e,this.props.max))}},{key:"_moveDownOneStep",value:function(){var e=this.state.value[this.state.index]-this.props.step;this._move(Math.max(e,this.props.min))}},{key:"_getValueFromPosition",value:function(e){var t=e/(this.state.sliderLength-this.state.handleSize)*(this.props.max-this.props.min);return this._trimAlignValue(this.state.startValue+t)}},{key:"_getDiffPosition",value:function(e){var t=e-this.state.startPosition;return this.props.invert&&(t*=-1),t}},{key:"_move",value:function(e){this.hasMoved=!0;var t=this.props,n=this.state,i=n.index,s=n.value,o=s.length,r=s[i],a=t.minDistance;if(!t.pearling){if(i>0){var u=s[i-1];e<u+a&&(e=u+a)}if(i<o-1){var l=s[i+1];e>l-a&&(e=l-a)}}s[i]=e,t.pearling&&o>1&&(e>r?(this._pushSucceeding(s,a,i),this._trimSucceeding(o,s,a,t.max)):e<r&&(this._pushPreceding(s,a,i),this._trimPreceding(o,s,a,t.min))),e!==r&&this.setState({value:s},this._fireChangeEvent.bind(this,"onChange"))}},{key:"_pushSucceeding",value:function(e,t,n){var i=void 0,s=void 0;for(s=e[i=n]+t;null!=e[i+1]&&s>e[i+1];i++,s=e[i]+t)e[i+1]=this._alignValue(s)}},{key:"_trimSucceeding",value:function(e,t,n,i){for(var s=0;s<e;s++){var o=i-s*n;t[e-1-s]>o&&(t[e-1-s]=o)}}},{key:"_pushPreceding",value:function(e,t,n){var i=void 0,s=void 0;for(s=e[i=n]-t;null!=e[i-1]&&s<e[i-1];i--,s=e[i]-t)e[i-1]=this._alignValue(s)}},{key:"_trimPreceding",value:function(e,t,n,i){for(var s=0;s<e;s++){var o=i+s*n;t[s]<o&&(t[s]=o)}}},{key:"_axisKey",value:function(){var e=this.props.orientation;return e===a?"X":e===u?"Y":void 0}},{key:"_orthogonalAxisKey",value:function(){var e=this.props.orientation;return e===a?"Y":e===u?"X":void 0}},{key:"_posMinKey",value:function(){var e=this.props.orientation;return e===a?this.props.invert?"right":"left":e===u?this.props.invert?"bottom":"top":void 0}},{key:"_posMaxKey",value:function(){var e=this.props.orientation;return e===a?this.props.invert?"left":"right":e===u?this.props.invert?"top":"bottom":void 0}},{key:"_sizeKey",value:function(){var e=this.props.orientation;return e===a?"clientWidth":e===u?"clientHeight":void 0}},{key:"_trimAlignValue",value:function(e,t){return this._alignValue(this._trimValue(e,t),t)}},{key:"_trimValue",value:function(e,t){return t=t||this.props,e<=t.min&&(e=t.min),e>=t.max&&(e=t.max),e}},{key:"_alignValue",value:function(e,t){var n=(e-(t=t||this.props).min)%t.step,i=e-n;return 2*Math.abs(n)>=t.step&&(i+=n>0?t.step:-t.step),parseFloat(i.toFixed(5))}},{key:"_renderHandle",value:function(e,n,i){var s=this.props.handleClassName+" "+this.props.handleClassName+"-"+i+" "+(this.state.index===i?this.props.handleActiveClassName:"");return t.createElement("div",{ref:"handle"+i,key:"handle"+i,className:s,style:e,onMouseDown:this._createOnMouseDown(i),onTouchStart:this._createOnTouchStart(i),onFocus:this._createOnKeyDown(i),tabIndex:0,role:"slider","aria-valuenow":this.state.value[i],"aria-valuemin":this.props.min,"aria-valuemax":this.props.max},n)}},{key:"_renderHandles",value:function(e){for(var n=e.length,i=new Array(n),s=0;s<n;s++)i[s]=this._buildHandleStyle(e[s],s);var o=new Array(n),r=this._renderHandle;if(t.Children.count(this.props.children)>0)t.Children.forEach(this.props.children,function(e,t){o[t]=r(i[t],e,t)});else for(var a=0;a<n;a++)o[a]=r(i[a],null,a);return o}},{key:"_renderBar",value:function(e,n,i){return t.createElement("div",{key:"bar"+e,ref:"bar"+e,className:this.props.barClassName+" "+this.props.barClassName+"-"+e,style:this._buildBarStyle(n,this.state.upperBound-i)})}},{key:"_renderBars",value:function(e){var t=[],n=e.length-1;t.push(this._renderBar(0,0,e[0]));for(var i=0;i<n;i++)t.push(this._renderBar(i+1,e[i],e[i+1]));return t.push(this._renderBar(n+1,e[n],this.state.upperBound)),t}},{key:"_onSliderMouseDown",value:function(e){if(!this.props.disabled){if(this.hasMoved=!1,!this.props.snapDragDisabled){var t=this._getMousePosition(e);this._forceValueFromPosition(t[0],function(e){this._fireChangeEvent("onChange"),this._start(e,t[0]),s(this._getMouseEventMap())}.bind(this))}i(e)}}},{key:"_onSliderClick",value:function(e){if(!this.props.disabled&&this.props.onSliderClick&&!this.hasMoved){var t=this._getMousePosition(e),n=this._trimAlignValue(this._calcValue(this._calcOffsetFromPosition(t[0])));this.props.onSliderClick(n)}}},{key:"_fireChangeEvent",value:function(e){this.props[e]&&this.props[e](r(this.state.value))}},{key:"render",value:function(){for(var e=this.state,n=this.props,i=e.value,s=i.length,o=new Array(s),r=0;r<s;r++)o[r]=this._calcOffset(i[r],r);var a=n.withBars?this._renderBars(o):null,u=this._renderHandles(o);return t.createElement("div",{ref:"slider",style:{position:"relative"},className:n.className+(n.disabled?" disabled":""),onMouseDown:this._onSliderMouseDown,onClick:this._onSliderClick},a,u)}}]),l}();return m.propTypes=h,m.defaultProps=l,m});
